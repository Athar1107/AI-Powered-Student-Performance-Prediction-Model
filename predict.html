<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Student Performance Prediction</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    .floating-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 8s ease-in-out infinite;
    }

    .particle:nth-child(1) { width: 20px; height: 20px; top: 10%; left: 20%; animation-delay: 0s; }
    .particle:nth-child(2) { width: 15px; height: 15px; top: 70%; left: 80%; animation-delay: 2s; }
    .particle:nth-child(3) { width: 25px; height: 25px; top: 40%; left: 10%; animation-delay: 4s; }
    .particle:nth-child(4) { width: 18px; height: 18px; top: 80%; left: 70%; animation-delay: 6s; }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
      50% { transform: translateY(-30px) rotate(180deg); opacity: 1; }
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 25px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 500px;
      text-align: center;
      position: relative;
      z-index: 2;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transform: perspective(1000px) rotateX(5deg);
      transition: all 0.3s ease;
    }

    .container:hover {
      transform: perspective(1000px) rotateX(0deg) translateY(-5px);
      box-shadow: 0 35px 70px rgba(0,0,0,0.3);
    }

    h1 {
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
      font-size: 2.2rem;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    h3 {
      color: #333;
      margin: 20px 0 15px 0;
      font-weight: 600;
    }

    form {
      margin: 15px 0;
    }

    input, button {
      margin: 8px 0;
      padding: 12px 15px;
      width: 100%;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      font-family: inherit;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      cursor: pointer;
      font-weight: 600;
      border: none;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      transform: perspective(1000px) rotateX(10deg);
    }

    button:hover {
      transform: perspective(1000px) rotateX(0deg) translateY(-3px);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: perspective(1000px) rotateX(5deg) translateY(-1px);
    }

    .error {
      color: #e74c3c;
      background: linear-gradient(135deg, #fdf2f2, #fce4e4);
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      box-shadow: 0 8px 25px rgba(231, 76, 60, 0.2);
      border-left: 5px solid #e74c3c;
      transform: perspective(1000px) rotateY(-2deg);
    }

    .result {
      color: #27ae60;
      background: linear-gradient(135deg, #f0f9f0, #e8f5e8);
      padding: 20px;
      border-radius: 15px;
      font-weight: bold;
      margin: 20px 0;
      box-shadow: 0 8px 25px rgba(39, 174, 96, 0.2);
      border-left: 5px solid #27ae60;
      transform: perspective(1000px) rotateY(2deg);
    }

    .table-container {
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #667eea, transparent);
      margin: 30px 0;
      border-radius: 2px;
    }

    .form-section {
      background: rgba(255, 255, 255, 0.5);
      padding: 25px;
      border-radius: 20px;
      margin: 20px 0;
      border: 1px solid rgba(102, 126, 234, 0.1);
      transform: perspective(1000px) rotateY(1deg);
      transition: all 0.3s ease;
    }

    .form-section:hover {
      transform: perspective(1000px) rotateY(0deg);
      background: rgba(255, 255, 255, 0.7);
    }

    .icon-3d {
      font-size: 2rem;
      margin-bottom: 15px;
      display: inline-block;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="floating-particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <div class="container">
    <div class="icon-3d">üéì</div>
    <h1>AI-Powered Student Performance Prediction</h1>
    <p class="subtitle">Using trained machine learning model for accurate predictions</p>

    <div id="error" class="error hidden"></div>
    <div id="result" class="result hidden"></div>
    <div id="tableContainer" class="table-container hidden"></div>

    <div class="form-section">
      <form id="csvForm">
        <h3>üìÅ Upload CSV File:</h3>
        <input type="file" id="csvFile" accept=".csv">
        <button type="submit">üöÄ Predict from CSV</button>
      </form>
    </div>

    <hr>

    <div class="form-section">
      <h3>‚úèÔ∏è Or Enter Marks Manually:</h3>
      <form id="manualForm">
        <input type="number" step="any" id="quiz1" placeholder="üìù Quiz01 [10]" required>
        <input type="number" step="any" id="assign1" placeholder="üìã Assignment01 [8]" required>
        <input type="number" step="any" id="midterm" placeholder="üìä Midterm Exam [20]" required>
        <input type="number" step="any" id="assign2" placeholder="üìù Assignment02 [12]" required>
        <input type="number" step="any" id="assign3" placeholder="üìã Assignment03 [25]" required>
        <input type="number" step="any" id="final" placeholder="üéØ Final Exam [35]" required>
        <button type="submit">ü§ñ AI Predict</button>
      </form>
    </div>
  </div>

  <script>
    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
      document.getElementById('result').classList.add('hidden');
    }

    function showResult(message) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = message;
      resultDiv.classList.remove('hidden');
      document.getElementById('error').classList.add('hidden');
    }

    async function predictWithModel(quiz1, assign1, midterm, assign2, assign3, final) {
      try {
        const response = await fetch('/predict', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            quiz1, assign1, midterm, assign2, assign3, final
          })
        });
        
        const data = await response.json();
        if (response.ok) {
          return data;
        } else {
          throw new Error(data.error || 'Prediction failed');
        }
      } catch (error) {
        throw new Error('Failed to connect to prediction service: ' + error.message);
      }
    }

    async function predictCSVWithModel(csvData) {
      try {
        const response = await fetch('/predict_csv', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ csv_data: csvData })
        });
        
        const data = await response.json();
        if (response.ok) {
          return data;
        } else {
          throw new Error(data.error || 'CSV prediction failed');
        }
      } catch (error) {
        throw new Error('Failed to connect to prediction service: ' + error.message);
      }
    }

    document.getElementById('manualForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const quiz1 = parseFloat(document.getElementById('quiz1').value);
      const assign1 = parseFloat(document.getElementById('assign1').value);
      const midterm = parseFloat(document.getElementById('midterm').value);
      const assign2 = parseFloat(document.getElementById('assign2').value);
      const assign3 = parseFloat(document.getElementById('assign3').value);
      const final = parseFloat(document.getElementById('final').value);

      if (quiz1 > 10 || assign1 > 8 || midterm > 20 || assign2 > 12 || assign3 > 25 || final > 35) {
        showError('Please enter marks within the specified limits.');
        return;
      }

      try {
        showResult('Predicting... Please wait.');
        const result = await predictWithModel(quiz1, assign1, midterm, assign2, assign3, final);
        
        // Store data for dashboard
        const studentData = {
          quiz1, assign1, midterm, assign2, assign3, final,
          total: result.total,
          percentage: result.percentage,
          prediction: result.prediction,
          timestamp: new Date().toISOString()
        };
        
        let studentsData = JSON.parse(localStorage.getItem('studentsData') || '[]');
        studentsData.push(studentData);
        localStorage.setItem('studentsData', JSON.stringify(studentsData));
        
        showResult(`ü§ñ AI Prediction: ${result.prediction} | Total: ${result.total}/110 (${result.percentage}%) | <a href="/dashboard" style="color: #667eea;">View Dashboard</a>`);
      } catch (error) {
        showError(error.message);
      }
    });

    document.getElementById('csvForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const fileInput = document.getElementById('csvFile');
      if (!fileInput.files[0]) {
        showError('Please select a CSV file.');
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = async function(e) {
        try {
          const csv = e.target.result;
          showResult('Processing CSV with AI model... Please wait.');
          
          const data = await predictCSVWithModel(csv);
          
          let tableHTML = '<table style="width:100%; border-collapse: collapse;"><tr>';
          data.headers.forEach(header => {
            tableHTML += `<th style="border: 1px solid #ddd; padding: 8px; background: #f5f5f5;">${header}</th>`;
          });
          tableHTML += '<th style="border: 1px solid #ddd; padding: 8px; background: #f5f5f5;">ü§ñ AI Prediction</th></tr>';

          // Store CSV data for dashboard
          let studentsData = JSON.parse(localStorage.getItem('studentsData') || '[]');
          
          data.results.forEach(result => {
            tableHTML += '<tr>';
            result.original_data.forEach(value => {
              tableHTML += `<td style="border: 1px solid #ddd; padding: 8px;">${value}</td>`;
            });
            tableHTML += `<td style="border: 1px solid #ddd; padding: 8px; font-weight: bold; color: #1b6ca8;">${result.prediction} (${result.percentage}%)</td></tr>`;
            
            // Store each student's data
            studentsData.push({
              quiz1: result.original_data[0],
              assign1: result.original_data[1],
              midterm: result.original_data[2],
              assign2: result.original_data[3],
              assign3: result.original_data[4],
              final: result.original_data[5],
              total: result.total,
              percentage: result.percentage,
              prediction: result.prediction,
              timestamp: new Date().toISOString()
            });
          });
          
          localStorage.setItem('studentsData', JSON.stringify(studentsData));
          tableHTML += '</table>';

          document.getElementById('tableContainer').innerHTML = tableHTML;
          document.getElementById('tableContainer').classList.remove('hidden');
          showResult(`ü§ñ AI predictions completed! Processed ${data.results.length} students. | <a href="/dashboard" style="color: #667eea;">View Dashboard</a>`);
        } catch (error) {
          showError(error.message);
        }
      };
      
      reader.readAsText(file);
    });
  </script>
</body>
</html>
